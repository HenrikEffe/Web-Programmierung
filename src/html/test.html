<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <script src="../../script.js"></script>
    <title>Startseite</title>
</head>

<body>
    <div class="menu-wrap">
        <input type="checkbox" class="toggler">
        <div class="hamburger">
            <div></div>
        </div>
        <div class="menu">
            <div>
                <div>
                    <ul>
                        <li><a href="index.html">Startseite</a></li>
                        <li><a href="songs.html">Alle Songs</a></li>
                        <li><a href="playlists.html">Playlists</a></li>
                        <li><a href="playsite.html">Abspielseite</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="main_content">
        <div class="header">
            <h1>Test f√ºr die Crawl Seite</h1>
        </div>
        <div class="body">
            <div style="margin:40px 0px; border:1px solid">
                <ul id="liste">Test</ul>
            </div>
            <iframe id="musikframe" src="http://localhost/Web-Programmierung/musik" width="100%"
                height="480px"></iframe>


        </div>
    </div>

</body>


</html>
<script type="text/javascript">

    document.body.onload = function () {
        var ifrm = document.createElement("iframe");
        ifrm.setAttribute("id", "musikframe");
        ifrm.setAttribute("src", "http://localhost/Web-Programmierung/musik");
        ifrm.style.display = "none";
        ifrm.style.width = "100%";
        ifrm.style.height = "480px";
        document.body.appendChild(ifrm);


        var iframe = document.getElementById("musikframe");
        iframe.onload = function (event) {
            readSongs(document.getElementById("musikframe"));
        };
        localStorage.clear();
    }
    // ausgabe des Local Storage
    // window.addEventListener("load", function () {
    // myFunction();
    for (let i = 0; i < localStorage.length; i++) {
        let storageKey = localStorage.key(i);
        console.log(storageKey + ' : ' + localStorage.getItem(storageKey));
    }
    // });




    async function readFolder(source) {
        var ifrm = document.createElement("iframe");
        ifrm.setAttribute("id", source.textContent);
        ifrm.setAttribute("src", source);
        ifrm.style.display = "none";
        ifrm.style.width = "100%";
        ifrm.style.height = "480px";
        document.body.appendChild(ifrm);
        var iframe = document.getElementById(source.textContent);
        iframe.onload = function (event) {
            readSongs(document.getElementById(source.textContent));
        };
    }
    async function readSongs(iframe) {
        var iframebody = iframe.contentWindow.document.querySelector('table').rows;
        console.log(iframebody.length);
        for (var key = 0; key < iframebody.length; key++) {
            var select = iframebody[key].querySelector('a');
            if (select != null && (select.toString().includes(".mp3") || select.toString().includes(".ogg"))) {
                // Musik in Webstorage speichern (ohne Ordner Zuweisung)
                if (typeof (Storage) !== "undefined") {
                    // setItem("Titel", "Link")
                    console.log("ich schreibe");
                    localStorage.setItem(select.textContent, select);
                } else {
                    allert("Sorry! No Web Storage support...")
                }
            } else if (select != null && select.toString().slice(-1) == "/" && select.toString().includes("musik") && key != 2) {
                // Unterordner aufrufen und Musik mit Ordner speichern
                readFolder(select);
            }
        }
    }
    function myFunction() {
        var elements = document.getElementsByTagName("iframe");

        while (elements.length) {
            elements[0].parentNode.removeChild(elements[0]);
        }
    }



    // let blob = await fetch(iframebody[3].querySelector('a')).then(r => r.blob());
    // // loadAsUrl(blob);
    // var file = jDataView.createBuffer(
    //     0x10, 0x01, 0x00, 0x00, // Int32 - 272
    //     0x90, 0xcf, 0x1b, 0x47, // Float32 - 39887.5625
    //     0, 0, 0, 0, 0, 0, 0, 0, // 8 blank bytes
    //     0x4d, 0x44, 0x32, 0x30, // String - MD20
    //     0x61                    // Char - a
    // );

    // var reader = new FileReader();

    // reader.onload = function (e) {
    //     var dv = new jDataView(file);

    //     // "TAG" starts at byte -128 from EOF.
    //     // See http://en.wikipedia.org/wiki/ID3
    //     if (dv.getString(3, dv.byteLength - 128) == 'TAG') {
    //         var title = dv.getString(30, dv.tell());
    //         var artist = dv.getString(30, dv.tell());
    //         var album = dv.getString(30, dv.tell());
    //         var year = dv.getString(4, dv.tell());
    //         console.log("test", title);
    //     } else {
    //         // no ID3v1 data found.
    //         console.log("hallo", title);
    //     }
    // };

    // reader.readAsArrayBuffer(blob);

    // function loadAsUrl(theFile) {
    //     var reader = new FileReader();

    //     reader.onload = function (theFile) {
    //         var dv = new jDataView(this.result);

    //         // "TAG" starts at byte -128 from EOF.
    //         // See http://en.wikipedia.org/wiki/ID3

    //     };

    //     reader.readAsArrayBuffer(theFile);
    // };

    // function loadAsUrl(theFile) {
    //     var reader = new FileReader();

    //     reader.onload = function (loadedEvent) {
    //         // var arrayBuffer = loadedEvent.target.result;
    //         // var dataView = new DataView(arrayBuffer, 0, arrayBuffer.byteLength);
    //         // var byte = dataView.getUint8(0);   //gets first byte of ArrayBuffer

    //         // console.log(dataView.buffer);

    //         var dv = new jDataView(this.result);

    //         if (dv.getString(3, dv.byteLength - 128) == 'TAG') {
    //             var title = dv.getString(30, dv.tell());
    //             var artist = dv.getString(30, dv.tell());
    //             var album = dv.getString(30, dv.tell());
    //             var year = dv.getString(4, dv.tell());
    //         } else {
    //             // no ID3v1 data found.
    //         }

        // var reader = new FileReader();


    //     }
    //     reader.readAsArrayBuffer(theFile);
    // }
</script>